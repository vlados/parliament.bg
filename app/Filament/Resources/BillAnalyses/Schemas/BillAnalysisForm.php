<?php

namespace App\Filament\Resources\BillAnalyses\Schemas;

use App\Models\Bill;
use App\Models\Transcript;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Infolists\Components\TextEntry;
use Filament\Schemas\Components\Section;
use Filament\Schemas\Schema;

class BillAnalysisForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                Section::make('üîç –û—Å–Ω–æ–≤–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∞–Ω–∞–ª–∏–∑–∞')
                    ->description('–û—Å–Ω–æ–≤–Ω–∏ –¥–∞–Ω–Ω–∏ –∑–∞ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç–∞')
                    ->icon('heroicon-o-document-magnifying-glass')
                    ->schema([
                        TextEntry::make('id')
                            ->label('ID –Ω–∞ –∞–Ω–∞–ª–∏–∑')
                            ->state(fn ($record) => $record?->id ?? '–ù–æ–≤ –∞–Ω–∞–ª–∏–∑')
                            ->extraAttributes(['class' => 'text-lg font-bold text-primary-600'])
                            ->columnSpanFull(),

                        TextInput::make('bill_identifier')
                            ->label('–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞ –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç')
                            ->prefixIcon('heroicon-o-document-text')
                            ->helperText('–û—Ñ–∏—Ü–∏–∞–ª–µ–Ω –Ω–æ–º–µ—Ä –∏–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä'),

                        TextInput::make('proposer_name')
                            ->label('–ü—Ä–µ–¥–ª–æ–∂–∏–ª')
                            ->prefixIcon('heroicon-o-user')
                            ->helperText('–ò–º–µ –Ω–∞ –ª–∏—Ü–µ—Ç–æ/–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ç–∞, –ø—Ä–µ–¥–ª–æ–∂–∏–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ—Ç–æ'),

                        Select::make('amendment_type')
                            ->label('–¢–∏–ø –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ—Ç–æ')
                            ->options([
                                'new' => '–ù–æ–≤ —Ç–µ–∫—Å—Ç',
                                'modification' => '–ò–∑–º–µ–Ω–µ–Ω–∏–µ',
                                'deletion' => '–ó–∞–ª–∏—á–∞–≤–∞–Ω–µ',
                            ])
                            ->prefixIcon('heroicon-o-pencil-square')
                            ->helperText('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ'),

                        Select::make('status')
                            ->label('–°—Ç–∞—Ç—É—Å')
                            ->options([
                                'proposed' => '–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–æ',
                                'approved' => '–û–¥–æ–±—Ä–µ–Ω–æ',
                                'rejected' => '–û—Ç—Ö–≤—ä—Ä–ª–µ–Ω–æ',
                                'pending' => '–í –æ—á–∞–∫–≤–∞–Ω–µ',
                            ])
                            ->prefixIcon('heroicon-o-flag')
                            ->helperText('–¢–µ–∫—É—â–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ—Ç–æ'),
                    ])
                    ->columns(2),

                Section::make('ü§ñ AI –ê–Ω–∞–ª–∏–∑ –∏ –¥–æ–≤–µ—Ä–∏–µ')
                    ->description('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ AI –∞–Ω–∞–ª–∏–∑–∞ –∏ –Ω–∏–≤–æ—Ç–æ –Ω–∞ –¥–æ–≤–µ—Ä–∏–µ')
                    ->icon('heroicon-o-cpu-chip')
                    ->schema([
                        TextEntry::make('confidence_percentage')
                            ->label('–ù–∏–≤–æ –Ω–∞ –¥–æ–≤–µ—Ä–∏–µ')
                            ->state(fn ($record) => $record?->confidence_percentage ?? '–ù—è–º–∞ –¥–∞–Ω–Ω–∏')
                            ->extraAttributes(['class' => 'text-lg font-bold'])
                            ->badge()
                            ->color(fn ($record) => $record?->confidence_color ?? 'gray'),

                        TextInput::make('ai_confidence')
                            ->label('AI –¥–æ–≤–µ—Ä–∏–µ (0.0-1.0)')
                            ->numeric()
                            ->step(0.0001)
                            ->minValue(0)
                            ->maxValue(1)
                            ->prefixIcon('heroicon-o-calculator')
                            ->helperText('–¢–æ—á–Ω–æ –Ω–∏–≤–æ –Ω–∞ –¥–æ–≤–µ—Ä–∏–µ –æ—Ç AI –∞–Ω–∞–ª–∏–∑–∞'),

                        TextEntry::make('status_label')
                            ->label('–°—Ç–∞—Ç—É—Å –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏')
                            ->state(fn ($record) => $record?->status_label ?? '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')
                            ->extraAttributes(['class' => 'font-medium'])
                            ->badge()
                            ->color(fn ($record) => $record?->status_color ?? 'gray'),

                        TextEntry::make('amendment_type_label')
                            ->label('–¢–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ –±—ä–ª–≥–∞—Ä—Å–∫–∏')
                            ->state(fn ($record) => $record?->amendment_type_label ?? '–ù—è–º–∞ –¥–∞–Ω–Ω–∏')
                            ->extraAttributes(['class' => 'font-medium']),
                    ])
                    ->columns(2),

                Section::make('üó≥Ô∏è –†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –≥–ª–∞—Å—É–≤–∞–Ω–µ')
                    ->description('–î–∞–Ω–Ω–∏ –∑–∞ –≥–ª–∞—Å—É–≤–∞–Ω–µ—Ç–æ, –∞–∫–æ –µ –Ω–∞–ª–∏—á–Ω–æ')
                    ->icon('heroicon-o-hand-raised')
                    ->schema([
                        TextEntry::make('formatted_vote_results')
                            ->label('–†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –≥–ª–∞—Å—É–≤–∞–Ω–µ—Ç–æ')
                            ->state(fn ($record) => $record?->formatted_vote_results ?? '–ù—è–º–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –≥–ª–∞—Å—É–≤–∞–Ω–µ')
                            ->extraAttributes(['class' => 'text-lg font-medium'])
                            ->columnSpanFull(),

                        Textarea::make('vote_results')
                            ->label('JSON –¥–∞–Ω–Ω–∏ –∑–∞ –≥–ª–∞—Å—É–≤–∞–Ω–µ—Ç–æ')
                            ->disabled()
                            ->rows(3)
                            ->state(fn ($record) => $record?->vote_results ? json_encode($record->vote_results, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) : null)
                            ->helperText('–°—É—Ä–æ–≤–∏ –¥–∞–Ω–Ω–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç')
                            ->columnSpanFull(),
                    ]),

                Section::make('üìã –í—Ä—ä–∑–∫–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç')
                    ->description('–í—Ä—ä–∑–∫–∏ –∫—ä–º –¥—Ä—É–≥–∏ –∑–∞–ø–∏—Å–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è')
                    ->icon('heroicon-o-link')
                    ->schema([
                        Select::make('transcript_id')
                            ->label('–°—Ç–µ–Ω–æ–≥—Ä–∞–º–∞')
                            ->relationship('transcript', 'title')
                            ->searchable()
                            ->preload()
                            ->prefixIcon('heroicon-o-document')
                            ->helperText('–°—Ç–µ–Ω–æ–≥—Ä–∞–º–∞—Ç–∞, –æ—Ç –∫–æ—è—Ç–æ –µ –∏–∑–≤–ª–µ—á–µ–Ω –∞–Ω–∞–ª–∏–∑—ä—Ç'),

                        Select::make('bill_id')
                            ->label('–°–≤—ä—Ä–∑–∞–Ω –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç')
                            ->relationship('bill', 'title')
                            ->searchable()
                            ->preload()
                            ->prefixIcon('heroicon-o-document-text')
                            ->helperText('–ó–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç—ä—Ç, –∫–æ–π—Ç–æ —Å–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞ (–∞–∫–æ –µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞–Ω)'),

                        TextEntry::make('transcript.title')
                            ->label('–ó–∞–≥–ª–∞–≤–∏–µ –Ω–∞ —Å—Ç–µ–Ω–æ–≥—Ä–∞–º–∞')
                            ->state(fn ($record) => $record?->transcript?->title ?? '–ù—è–º–∞ –¥–∞–Ω–Ω–∏')
                            ->limit(100)
                            ->columnSpanFull(),

                        TextEntry::make('bill.title')
                            ->label('–ó–∞–≥–ª–∞–≤–∏–µ –Ω–∞ –∑–∞–∫–æ–Ω–æ–ø—Ä–æ–µ–∫—Ç')
                            ->state(fn ($record) => $record?->bill?->title ?? '–ù–µ –µ —Å–≤—ä—Ä–∑–∞–Ω')
                            ->limit(100)
                            ->columnSpanFull(),
                    ])
                    ->columns(2),

                Section::make('üìù –û–ø–∏—Å–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç')
                    ->description('–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ—Ç–æ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç')
                    ->icon('heroicon-o-document-text')
                    ->schema([
                        Textarea::make('amendment_description')
                            ->label('–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ—Ç–æ')
                            ->rows(4)
                            ->helperText('–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ')
                            ->columnSpanFull(),

                        Textarea::make('raw_context')
                            ->label('–°—É—Ä–æ–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç')
                            ->disabled()
                            ->rows(6)
                            ->helperText('–û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç —Ç–µ–∫—Å—Ç –æ—Ç —Å—Ç–µ–Ω–æ–≥—Ä–∞–º–∞—Ç–∞, –∏–∑–ø–æ–ª–∑–≤–∞–Ω –∑–∞ –∞–Ω–∞–ª–∏–∑–∞')
                            ->columnSpanFull(),

                        Textarea::make('metadata')
                            ->label('–ú–µ—Ç–∞–¥–∞–Ω–Ω–∏')
                            ->disabled()
                            ->rows(3)
                            ->state(fn ($record) => $record?->metadata ? json_encode($record->metadata, JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE) : null)
                            ->helperText('–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç')
                            ->columnSpanFull(),
                    ]),

                Section::make('‚è∞ –°–∏—Å—Ç–µ–º–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è')
                    ->description('–î–∞—Ç–∏ –Ω–∞ —Å—ä–∑–¥–∞–≤–∞–Ω–µ –∏ –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω–µ')
                    ->icon('heroicon-o-clock')
                    ->schema([
                        TextEntry::make('created_at')
                            ->label('–°—ä–∑–¥–∞–¥–µ–Ω –Ω–∞')
                            ->state(fn ($record) => $record?->created_at?->format('d.m.Y H:i:s') ?? '–ù—è–º–∞ –¥–∞–Ω–Ω–∏')
                            ->extraAttributes(['class' => 'text-gray-600']),

                        TextEntry::make('updated_at')
                            ->label('–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–Ω –Ω–∞')
                            ->state(fn ($record) => $record?->updated_at?->format('d.m.Y H:i:s') ?? '–ù—è–º–∞ –¥–∞–Ω–Ω–∏')
                            ->extraAttributes(['class' => 'text-gray-600']),
                    ])
                    ->columns(2),
            ]);
    }
}